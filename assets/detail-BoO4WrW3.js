var I=e=>{throw TypeError(e)};var M=(e,t,s)=>t.has(e)||I("Cannot "+s);var o=(e,t,s)=>(M(e,t,"read from private field"),s?s.call(e):t.get(e)),g=(e,t,s)=>t.has(e)?I("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,s),y=(e,t,s,r)=>(M(e,t,"write to private field"),r?r.call(e,s):t.set(e,s),s),j=(e,t,s)=>(M(e,t,"access private method"),s);import{S as q,D as K,$ as P,a0 as k,O as D,P as z,r as v,u as U,j as b,a1 as _}from"./index-jpWX0MXq.js";import{a as w}from"./react-B2eEhSVY.js";import{aA as E}from"./antd-C3AkHkw7.js";import{D as T}from"./index-DKVvvQBM.js";import{W as L}from"./BaseForm-BlxxxcRg.js";import{W as $}from"./index-rqsPtctM.js";import{P as V}from"./index-XW-1-lDl.js";var d,p,n,l,m,C,R,A,B=(A=class extends q{constructor(t,s){super();g(this,m);g(this,d);g(this,p);g(this,n);g(this,l);y(this,d,t),this.setOptions(s),this.bindMethods(),j(this,m,C).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){var r;const s=this.options;this.options=o(this,d).defaultMutationOptions(t),K(this.options,s)||o(this,d).getMutationCache().notify({type:"observerOptionsUpdated",mutation:o(this,n),observer:this}),s!=null&&s.mutationKey&&this.options.mutationKey&&P(s.mutationKey)!==P(this.options.mutationKey)?this.reset():((r=o(this,n))==null?void 0:r.state.status)==="pending"&&o(this,n).setOptions(this.options)}onUnsubscribe(){var t;this.hasListeners()||(t=o(this,n))==null||t.removeObserver(this)}onMutationUpdate(t){j(this,m,C).call(this),j(this,m,R).call(this,t)}getCurrentResult(){return o(this,p)}reset(){var t;(t=o(this,n))==null||t.removeObserver(this),y(this,n,void 0),j(this,m,C).call(this),j(this,m,R).call(this)}mutate(t,s){var r;return y(this,l,s),(r=o(this,n))==null||r.removeObserver(this),y(this,n,o(this,d).getMutationCache().build(o(this,d),this.options)),o(this,n).addObserver(this),o(this,n).execute(t)}},d=new WeakMap,p=new WeakMap,n=new WeakMap,l=new WeakMap,m=new WeakSet,C=function(){var s;const t=((s=o(this,n))==null?void 0:s.state)??k();y(this,p,{...t,isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset})},R=function(t){D.batch(()=>{var s,r,a,h,i,f,x,O;if(o(this,l)&&this.hasListeners()){const c=o(this,p).variables,u=o(this,p).context;(t==null?void 0:t.type)==="success"?((r=(s=o(this,l)).onSuccess)==null||r.call(s,t.data,c,u),(h=(a=o(this,l)).onSettled)==null||h.call(a,t.data,null,c,u)):(t==null?void 0:t.type)==="error"&&((f=(i=o(this,l)).onError)==null||f.call(i,t.error,c,u),(O=(x=o(this,l)).onSettled)==null||O.call(x,void 0,t.error,c,u))}this.listeners.forEach(c=>{c(o(this,p))})})},A);function G(e,t){return typeof e=="function"?e(...t):!!e}function Q(){}function W(e,t){const s=z(),[r]=w.useState(()=>new B(s,e));w.useEffect(()=>{r.setOptions(e)},[r,e]);const a=w.useSyncExternalStore(w.useCallback(i=>r.subscribe(D.batchCalls(i)),[r]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),h=w.useCallback((i,f)=>{r.mutate(i,f).catch(Q)},[r]);if(a.error&&G(r.options.throwOnError,[a.error]))throw a.error;return{...a,mutate:h,mutateAsync:a.mutate}}function it(e){return v.get("role-list",{searchParams:e,ignoreLoading:!0}).json()}function H(e){return v.post("role-item",{json:e,ignoreLoading:!0}).json()}function J(e){return v.put("role-item",{json:e,ignoreLoading:!0}).json()}function nt(e){return v.delete("role-item",{json:e,ignoreLoading:!0}).json()}function at(){return v.get("role-menu",{ignoreLoading:!0}).json()}function ut(e){return v.get("menu-by-role-id",{searchParams:e,ignoreLoading:!1}).json()}function N({title:e,open:t,onCloseChange:s,detailData:r,treeData:a,refreshTable:h}){const{t:i}=U(),[f]=E.useForm(),x=W({mutationFn:H}),O=W({mutationFn:J}),c=async u=>{var S,F;return r.id?(await O.mutateAsync(u),(S=window.$message)==null||S.success(i("common.updateSuccess"))):(await x.mutateAsync(u),(F=window.$message)==null||F.success(i("common.addSuccess"))),h==null||h(),!0};return w.useEffect(()=>{t&&f.setFieldsValue(r)},[t]),b.jsxs(T,{title:e,open:t,onOpenChange:u=>{u===!1&&s()},resize:{onResize(){},maxWidth:window.innerWidth*.8,minWidth:500},labelCol:{span:6},wrapperCol:{span:24},layout:"horizontal",form:f,autoFocusFirstInput:!0,drawerProps:{destroyOnClose:!0},onFinish:c,initialValues:{status:1,menus:[]},children:[b.jsx(L,{allowClear:!0,rules:[{required:!0}],width:"md",name:"name",label:i("system.role.name"),tooltip:i("form.length",{length:24})}),b.jsx(L,{allowClear:!0,rules:[{required:!0}],width:"md",name:"code",label:i("system.role.id")}),b.jsx($.Group,{name:"status",label:i("common.status"),radioType:"button",options:[{label:i("common.enabled"),value:1},{label:i("common.deactivated"),value:0}]}),b.jsx(V,{allowClear:!0,width:"md",name:"remark",label:i("common.remark")}),b.jsx(E.Item,{name:"menus",label:i("system.role.assignMenu"),children:b.jsx(_,{treeData:a})})]})}const lt=Object.freeze(Object.defineProperty({__proto__:null,Detail:N},Symbol.toStringTag,{value:"Module"}));export{N as D,it as a,nt as b,at as c,lt as d,ut as f,Q as n,G as s,W as u};
