import{aP as p,aO as H,aQ as pe,aY as he,C as ge,aS as y,aV as be,bl as we,r as Ce,aW as V,aX as b,a3 as xe,b0 as Re}from"./antd-BreSrAtA.js";import{u as We,b as $e,f as ye,o as _e}from"./index-1qU7M37A.js";import{R as B,a as d}from"./react-UQ1dNgW8.js";import{j as f}from"./index-B4D4TeV5.js";import{B as Se}from"./BaseForm-BBX0u0Gz.js";var ze=typeof process<"u"&&process.versions!=null&&process.versions.node!=null,Fe=function(){return typeof window<"u"&&typeof window.document<"u"&&typeof window.matchMedia<"u"&&!ze},ke=function(m){return H({},m.componentCls,{"&-sidebar-dragger":{width:"5px",cursor:"ew-resize",padding:"4px 0 0",borderTop:"1px solid transparent",position:"absolute",top:0,left:0,bottom:0,zIndex:100,backgroundColor:"transparent","&-min-disabled":{cursor:"w-resize"},"&-max-disabled":{cursor:"e-resize"}}})};function De(l){return We("DrawerForm",function(m){var h=p(p({},m),{},{componentCls:".".concat(l)});return[ke(h)]})}var Me=["children","trigger","onVisibleChange","drawerProps","onFinish","submitTimeout","title","width","resize","onOpenChange","visible","open"];function Ee(l){var m,h,K=l.children,w=l.trigger,C=l.onVisibleChange,i=l.drawerProps,D=l.onFinish,x=l.submitTimeout,Z=l.title,_=l.width,c=l.resize,S=l.onOpenChange,z=l.visible,N=l.open,s=pe(l,Me);he(!s.footer||!(i!=null&&i.footer),"DrawerForm 是一个 ProForm 的特殊布局，如果想自定义按钮，请使用 submit.render 自定义。");var o=B.useMemo(function(){var t,e,r,n={onResize:function(){},maxWidth:Fe()?window.innerWidth*.8:void 0,minWidth:300};return typeof c=="boolean"?c?n:{}:$e({onResize:(t=c==null?void 0:c.onResize)!==null&&t!==void 0?t:n.onResize,maxWidth:(e=c==null?void 0:c.maxWidth)!==null&&e!==void 0?e:n.maxWidth,minWidth:(r=c==null?void 0:c.minWidth)!==null&&r!==void 0?r:n.minWidth})},[c]),R=d.useContext(ge.ConfigContext),U=R.getPrefixCls("pro-form-drawer"),X=De(U),ee=X.wrapSSR,A=X.hashId,M=function(e){return"".concat(U,"-").concat(e," ").concat(A)},re=d.useState([]),ne=y(re,2),oe=ne[1],te=d.useState(!1),G=y(te,2),P=G[0],T=G[1],ie=d.useState(!1),Q=y(ie,2),O=Q[0],j=Q[1],ae=d.useState(_||(c?o==null?void 0:o.minWidth:800)),Y=y(ae,2),I=Y[0],F=Y[1],le=be(!!z,{value:N||z,onChange:S||C}),q=y(le,2),W=q[0],g=q[1],k=d.useRef(null),se=d.useCallback(function(t){k.current===null&&t&&oe([]),k.current=t},[]),$=d.useRef(),ue=d.useCallback(function(){var t,e,r,n=(t=(e=(r=s.formRef)===null||r===void 0?void 0:r.current)!==null&&e!==void 0?e:s.form)!==null&&t!==void 0?t:$.current;n&&i!==null&&i!==void 0&&i.destroyOnClose&&n.resetFields()},[i==null?void 0:i.destroyOnClose,s.form,s.formRef]);d.useEffect(function(){W&&(N||z)&&(S==null||S(!0),C==null||C(!0)),O&&F(o==null?void 0:o.minWidth)},[z,W,O]),d.useImperativeHandle(s.formRef,function(){return $.current},[$.current]);var de=d.useMemo(function(){return w?B.cloneElement(w,p(p({key:"trigger"},w.props),{},{onClick:function(){var t=V(b().mark(function r(n){var u,a;return b().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:g(!W),j(!Object.keys(o)),(u=w.props)===null||u===void 0||(a=u.onClick)===null||a===void 0||a.call(u,n);case 3:case"end":return v.stop()}},r)}));function e(r){return t.apply(this,arguments)}return e}()})):null},[g,w,W,j,O]),ce=d.useMemo(function(){var t,e,r,n,u;return s.submitter===!1?!1:we({searchConfig:{submitText:(t=(e=R.locale)===null||e===void 0||(e=e.Modal)===null||e===void 0?void 0:e.okText)!==null&&t!==void 0?t:"确认",resetText:(r=(n=R.locale)===null||n===void 0||(n=n.Modal)===null||n===void 0?void 0:n.cancelText)!==null&&r!==void 0?r:"取消"},resetButtonProps:{preventDefault:!0,disabled:x?P:void 0,onClick:function(L){var v;g(!1),i==null||(v=i.onClose)===null||v===void 0||v.call(i,L)}}},(u=s.submitter)!==null&&u!==void 0?u:{})},[s.submitter,(m=R.locale)===null||m===void 0||(m=m.Modal)===null||m===void 0?void 0:m.okText,(h=R.locale)===null||h===void 0||(h=h.Modal)===null||h===void 0?void 0:h.cancelText,x,P,g,i]),ve=d.useCallback(function(t,e){return f.jsxs(f.Fragment,{children:[t,k.current&&e?f.jsx(B.Fragment,{children:Ce.createPortal(e,k.current)},"submitter"):e]})},[]),fe=ye(function(){var t=V(b().mark(function e(r){var n,u,a;return b().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return n=D==null?void 0:D(r),x&&n instanceof Promise&&(T(!0),u=setTimeout(function(){return T(!1)},x),n.finally(function(){clearTimeout(u),T(!1)})),v.next=4,n;case 4:return a=v.sent,a&&g(!1),v.abrupt("return",a);case 7:case"end":return v.stop()}},e)}));return function(e){return t.apply(this,arguments)}}()),me=_e(W,C),E=d.useCallback(function(t){var e,r,n=(document.body.offsetWidth||1e3)-(t.clientX-document.body.offsetLeft),u=(e=o==null?void 0:o.minWidth)!==null&&e!==void 0?e:_||800,a=(r=o==null?void 0:o.maxWidth)!==null&&r!==void 0?r:window.innerWidth*.8;if(n<u){F(u);return}if(n>a){F(a);return}F(n)},[o==null?void 0:o.maxWidth,o==null?void 0:o.minWidth,_]),J=d.useCallback(function(){document.removeEventListener("mousemove",E),document.removeEventListener("mouseup",J)},[E]);return ee(f.jsxs(f.Fragment,{children:[f.jsxs(xe,p(p(p({title:Z,width:I},i),me),{},{afterOpenChange:function(e){var r;e||ue(),i==null||(r=i.afterOpenChange)===null||r===void 0||r.call(i,e)},onClose:function(e){var r;x&&P||(g(!1),i==null||(r=i.onClose)===null||r===void 0||r.call(i,e))},footer:s.submitter!==!1&&f.jsx("div",{ref:se,style:{display:"flex",justifyContent:"flex-end"}}),children:[c?f.jsx("div",{className:Re(M("sidebar-dragger"),A,H(H({},M("sidebar-dragger-min-disabled"),I===(o==null?void 0:o.minWidth)),M("sidebar-dragger-max-disabled"),I===(o==null?void 0:o.maxWidth))),onMouseDown:function(e){var r;o==null||(r=o.onResize)===null||r===void 0||r.call(o),e.stopPropagation(),e.preventDefault(),document.addEventListener("mousemove",E),document.addEventListener("mouseup",J),j(!0)}}):null,f.jsx(f.Fragment,{children:f.jsx(Se,p(p({formComponentType:"DrawerForm",layout:"vertical"},s),{},{formRef:$,onInit:function(e,r){var n;s.formRef&&(s.formRef.current=r),s==null||(n=s.onInit)===null||n===void 0||n.call(s,e,r),$.current=r},submitter:ce,onFinish:function(){var t=V(b().mark(function e(r){var n;return b().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,fe(r);case 2:return n=a.sent,a.abrupt("return",n);case 4:case"end":return a.stop()}},e)}));return function(e){return t.apply(this,arguments)}}(),contentRender:ve,children:K}))})]})),de]}))}export{Ee as D,Fe as i};
