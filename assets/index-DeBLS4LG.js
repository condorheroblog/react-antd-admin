import{aJ as Z,a$ as ee,y as re,aI as S,a_ as ne,aK as v,bg as oe,r as te,aL as O,M as le,aM as C}from"./antd-DxuFB7J3.js";import{o as ae}from"./index-0qjF_P79.js";import{a as i,R as V}from"./react-DUVzRXT7.js";import{j as f}from"./index-DJDYVK2o.js";import{B as ie}from"./BaseForm-CYpHNqZU.js";var se=["children","trigger","onVisibleChange","onOpenChange","modalProps","onFinish","submitTimeout","title","width","visible","open"];function me(s){var m,p,D=s.children,h=s.trigger,_=s.onVisibleChange,$=s.onOpenChange,e=s.modalProps,k=s.onFinish,g=s.submitTimeout,B=s.title,H=s.width,R=s.visible,F=s.open,a=Z(s,se);ee(!a.footer||!(e!=null&&e.footer),"ModalForm 是一个 ProForm 的特殊布局，如果想自定义按钮，请使用 submit.render 自定义。");var T=i.useContext(re.ConfigContext),L=i.useState([]),A=S(L,2),G=A[1],J=i.useState(!1),I=S(J,2),P=I[0],w=I[1],K=ne(!!R,{value:F||R,onChange:$||_}),E=S(K,2),M=E[0],d=E[1],y=i.useRef(null),U=i.useCallback(function(o){y.current===null&&o&&G([]),y.current=o},[]),b=i.useRef(),W=i.useCallback(function(){var o,r,n,l=(o=(r=a.form)!==null&&r!==void 0?r:(n=a.formRef)===null||n===void 0?void 0:n.current)!==null&&o!==void 0?o:b.current;l&&e!==null&&e!==void 0&&e.destroyOnClose&&l.resetFields()},[e==null?void 0:e.destroyOnClose,a.form,a.formRef]);i.useImperativeHandle(a.formRef,function(){return b.current},[b.current]),i.useEffect(function(){(F||R)&&($==null||$(!0),_==null||_(!0))},[R,F]);var q=i.useMemo(function(){return h?V.cloneElement(h,v(v({key:"trigger"},h.props),{},{onClick:function(){var o=O(C().mark(function n(l){var u,t;return C().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:d(!M),(u=h.props)===null||u===void 0||(t=u.onClick)===null||t===void 0||t.call(u,l);case 2:case"end":return c.stop()}},n)}));function r(n){return o.apply(this,arguments)}return r}()})):null},[d,h,M]),z=i.useMemo(function(){var o,r,n,l,u,t,x;return a.submitter===!1?!1:oe({searchConfig:{submitText:(o=(r=e==null?void 0:e.okText)!==null&&r!==void 0?r:(n=T.locale)===null||n===void 0||(n=n.Modal)===null||n===void 0?void 0:n.okText)!==null&&o!==void 0?o:"确认",resetText:(l=(u=e==null?void 0:e.cancelText)!==null&&u!==void 0?u:(t=T.locale)===null||t===void 0||(t=t.Modal)===null||t===void 0?void 0:t.cancelText)!==null&&l!==void 0?l:"取消"},resetButtonProps:{preventDefault:!0,disabled:g?P:void 0,onClick:function(Y){var j;d(!1),e==null||(j=e.onCancel)===null||j===void 0||j.call(e,Y)}}},(x=a.submitter)!==null&&x!==void 0?x:{})},[(m=T.locale)===null||m===void 0||(m=m.Modal)===null||m===void 0?void 0:m.cancelText,(p=T.locale)===null||p===void 0||(p=p.Modal)===null||p===void 0?void 0:p.okText,e,a.submitter,d,P,g]),N=i.useCallback(function(o,r){return f.jsxs(f.Fragment,{children:[o,y.current&&r?f.jsx(V.Fragment,{children:te.createPortal(r,y.current)},"submitter"):r]})},[]),Q=i.useCallback(function(){var o=O(C().mark(function r(n){var l,u,t;return C().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return l=k==null?void 0:k(n),g&&l instanceof Promise&&(w(!0),u=setTimeout(function(){return w(!1)},g),l.finally(function(){clearTimeout(u),w(!1)})),c.next=4,l;case 4:return t=c.sent,t&&d(!1),c.abrupt("return",t);case 7:case"end":return c.stop()}},r)}));return function(r){return o.apply(this,arguments)}}(),[k,d,g]),X=ae(M);return f.jsxs(f.Fragment,{children:[f.jsx(le,v(v(v({title:B,width:H||800},e),X),{},{onCancel:function(r){var n;g&&P||(d(!1),e==null||(n=e.onCancel)===null||n===void 0||n.call(e,r))},afterClose:function(){var r;W(),M&&d(!1),e==null||(r=e.afterClose)===null||r===void 0||r.call(e)},footer:a.submitter!==!1?f.jsx("div",{ref:U,style:{display:"flex",justifyContent:"flex-end"}}):null,children:f.jsx(ie,v(v({formComponentType:"ModalForm",layout:"vertical"},a),{},{onInit:function(r,n){var l;a.formRef&&(a.formRef.current=n),a==null||(l=a.onInit)===null||l===void 0||l.call(a,r,n),b.current=n},formRef:b,submitter:z,onFinish:function(){var o=O(C().mark(function r(n){var l;return C().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Q(n);case 2:return l=t.sent,t.abrupt("return",l);case 4:case"end":return t.stop()}},r)}));return function(r){return o.apply(this,arguments)}}(),contentRender:N,children:D}))})),q]})}export{me as M};
