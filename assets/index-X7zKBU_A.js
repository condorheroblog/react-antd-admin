var de=t=>{throw TypeError(t)};var G=(t,e,r)=>e.has(t)||de("Cannot "+r);var s=(t,e,r)=>(G(t,e,"read from private field"),r?r.call(t):e.get(t)),y=(t,e,r)=>e.has(t)?de("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,r),u=(t,e,r,i)=>(G(t,e,"write to private field"),i?i.call(t,r):e.set(t,r),r),f=(t,e,r)=>(G(t,e,"access private method"),r);import{S as Ie,z as fe,C as E,D as Y,E as J,F as we,G as Z,H as pe,J as Ee,K as Te,M as De,N as me,O as xe,P as Qe,u as Fe,j as F,B as be,c as X,y as Me}from"./index-jpWX0MXq.js";import{s as Be,n as ye,u as je,f as Ue,a as ke,D as Pe,b as _e,c as Le}from"./detail-BoO4WrW3.js";import{u as Ae}from"./index-7xc74kBn.js";import{a as x}from"./react-B2eEhSVY.js";import{B as He}from"./index-CziQPL13.js";import{B as ze}from"./index-CJiJ404y.js";import{getConstantColumns as $e}from"./constants-DrWIvpB0.js";import{aI as Ne,k as qe,aJ as Ke}from"./antd-C3AkHkw7.js";import"./faker-Dcf0Eyuj.js";import"./index-DKVvvQBM.js";import"./index-CkzziYjv.js";import"./BaseForm-BlxxxcRg.js";import"./index-rqsPtctM.js";import"./index-XW-1-lDl.js";import"./index-7DMUwYVH.js";import"./index-B0zmMycq.js";var C,a,K,v,k,H,M,w,V,z,$,P,_,B,N,h,q,ee,te,se,re,ie,ae,ne,Se,Ce,Ve=(Ce=class extends Ie{constructor(e,r){super();y(this,h);y(this,C);y(this,a);y(this,K);y(this,v);y(this,k);y(this,H);y(this,M);y(this,w);y(this,V);y(this,z);y(this,$);y(this,P);y(this,_);y(this,B);y(this,N,new Set);this.options=r,u(this,C,e),u(this,w,null),u(this,M,fe()),this.options.experimental_prefetchInRender||s(this,M).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(r)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(s(this,a).addObserver(this),Re(s(this,a),this.options)?f(this,h,q).call(this):this.updateResult(),f(this,h,re).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return oe(s(this,a),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return oe(s(this,a),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,f(this,h,ie).call(this),f(this,h,ae).call(this),s(this,a).removeObserver(this)}setOptions(e,r){const i=this.options,d=s(this,a);if(this.options=s(this,C).defaultQueryOptions(e),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof E(this.options.enabled,s(this,a))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");f(this,h,ne).call(this),s(this,a).setOptions(this.options),i._defaulted&&!Y(this.options,i)&&s(this,C).getQueryCache().notify({type:"observerOptionsUpdated",query:s(this,a),observer:this});const c=this.hasListeners();c&&ge(s(this,a),d,this.options,i)&&f(this,h,q).call(this),this.updateResult(r),c&&(s(this,a)!==d||E(this.options.enabled,s(this,a))!==E(i.enabled,s(this,a))||J(this.options.staleTime,s(this,a))!==J(i.staleTime,s(this,a)))&&f(this,h,ee).call(this);const n=f(this,h,te).call(this);c&&(s(this,a)!==d||E(this.options.enabled,s(this,a))!==E(i.enabled,s(this,a))||n!==s(this,B))&&f(this,h,se).call(this,n)}getOptimisticResult(e){const r=s(this,C).getQueryCache().build(s(this,C),e),i=this.createResult(r,e);return Je(this,i)&&(u(this,v,i),u(this,H,this.options),u(this,k,s(this,a).state)),i}getCurrentResult(){return s(this,v)}trackResult(e,r){const i={};return Object.keys(e).forEach(d=>{Object.defineProperty(i,d,{configurable:!1,enumerable:!0,get:()=>(this.trackProp(d),r==null||r(d),e[d])})}),i}trackProp(e){s(this,N).add(e)}getCurrentQuery(){return s(this,a)}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){const r=s(this,C).defaultQueryOptions(e),i=s(this,C).getQueryCache().build(s(this,C),r);return i.fetch().then(()=>this.createResult(i,r))}fetch(e){return f(this,h,q).call(this,{...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),s(this,v)))}createResult(e,r){var ue;const i=s(this,a),d=this.options,c=s(this,v),n=s(this,k),S=s(this,H),R=e!==i?e.state:s(this,K),{state:O}=e;let l={...O},j=!1,m;if(r._optimisticResults){const g=this.hasListeners(),L=!g&&Re(e,r),A=g&&ge(e,i,r,d);(L||A)&&(l={...l,...De(O.data,e.options)}),r._optimisticResults==="isRestoring"&&(l.fetchStatus="idle")}let{error:U,errorUpdatedAt:b,status:o}=l;if(r.select&&l.data!==void 0)if(c&&l.data===(n==null?void 0:n.data)&&r.select===s(this,V))m=s(this,z);else try{u(this,V,r.select),m=r.select(l.data),m=me(c==null?void 0:c.data,m,r),u(this,z,m),u(this,w,null)}catch(g){u(this,w,g)}else m=l.data;if(r.placeholderData!==void 0&&m===void 0&&o==="pending"){let g;if(c!=null&&c.isPlaceholderData&&r.placeholderData===(S==null?void 0:S.placeholderData))g=c.data;else if(g=typeof r.placeholderData=="function"?r.placeholderData((ue=s(this,$))==null?void 0:ue.state.data,s(this,$)):r.placeholderData,r.select&&g!==void 0)try{g=r.select(g),u(this,w,null)}catch(L){u(this,w,L)}g!==void 0&&(o="success",m=me(c==null?void 0:c.data,g,r),j=!0)}s(this,w)&&(U=s(this,w),m=s(this,z),b=Date.now(),o="error");const T=l.fetchStatus==="fetching",D=o==="pending",Q=o==="error",ce=D&&T,le=m!==void 0,I={status:o,fetchStatus:l.fetchStatus,isPending:D,isSuccess:o==="success",isError:Q,isInitialLoading:ce,isLoading:ce,data:m,dataUpdatedAt:l.dataUpdatedAt,error:U,errorUpdatedAt:b,failureCount:l.fetchFailureCount,failureReason:l.fetchFailureReason,errorUpdateCount:l.errorUpdateCount,isFetched:l.dataUpdateCount>0||l.errorUpdateCount>0,isFetchedAfterMount:l.dataUpdateCount>R.dataUpdateCount||l.errorUpdateCount>R.errorUpdateCount,isFetching:T,isRefetching:T&&!D,isLoadingError:Q&&!le,isPaused:l.fetchStatus==="paused",isPlaceholderData:j,isRefetchError:Q&&le,isStale:he(e,r),refetch:this.refetch,promise:s(this,M)};if(this.options.experimental_prefetchInRender){const g=W=>{I.status==="error"?W.reject(I.error):I.data!==void 0&&W.resolve(I.data)},L=()=>{const W=u(this,M,I.promise=fe());g(W)},A=s(this,M);switch(A.status){case"pending":e.queryHash===i.queryHash&&g(A);break;case"fulfilled":(I.status==="error"||I.data!==A.value)&&L();break;case"rejected":(I.status!=="error"||I.error!==A.reason)&&L();break}}return I}updateResult(e){const r=s(this,v),i=this.createResult(s(this,a),this.options);if(u(this,k,s(this,a).state),u(this,H,this.options),s(this,k).data!==void 0&&u(this,$,s(this,a)),Y(i,r))return;u(this,v,i);const d={},c=()=>{if(!r)return!0;const{notifyOnChangeProps:n}=this.options,S=typeof n=="function"?n():n;if(S==="all"||!S&&!s(this,N).size)return!0;const p=new Set(S??s(this,N));return this.options.throwOnError&&p.add("error"),Object.keys(s(this,v)).some(R=>{const O=R;return s(this,v)[O]!==r[O]&&p.has(O)})};(e==null?void 0:e.listeners)!==!1&&c()&&(d.listeners=!0),f(this,h,Se).call(this,{...d,...e})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&f(this,h,re).call(this)}},C=new WeakMap,a=new WeakMap,K=new WeakMap,v=new WeakMap,k=new WeakMap,H=new WeakMap,M=new WeakMap,w=new WeakMap,V=new WeakMap,z=new WeakMap,$=new WeakMap,P=new WeakMap,_=new WeakMap,B=new WeakMap,N=new WeakMap,h=new WeakSet,q=function(e){f(this,h,ne).call(this);let r=s(this,a).fetch(this.options,e);return e!=null&&e.throwOnError||(r=r.catch(we)),r},ee=function(){f(this,h,ie).call(this);const e=J(this.options.staleTime,s(this,a));if(Z||s(this,v).isStale||!pe(e))return;const i=Ee(s(this,v).dataUpdatedAt,e)+1;u(this,P,setTimeout(()=>{s(this,v).isStale||this.updateResult()},i))},te=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(s(this,a)):this.options.refetchInterval)??!1},se=function(e){f(this,h,ae).call(this),u(this,B,e),!(Z||E(this.options.enabled,s(this,a))===!1||!pe(s(this,B))||s(this,B)===0)&&u(this,_,setInterval(()=>{(this.options.refetchIntervalInBackground||Te.isFocused())&&f(this,h,q).call(this)},s(this,B)))},re=function(){f(this,h,ee).call(this),f(this,h,se).call(this,f(this,h,te).call(this))},ie=function(){s(this,P)&&(clearTimeout(s(this,P)),u(this,P,void 0))},ae=function(){s(this,_)&&(clearInterval(s(this,_)),u(this,_,void 0))},ne=function(){const e=s(this,C).getQueryCache().build(s(this,C),this.options);if(e===s(this,a))return;const r=s(this,a);u(this,a,e),u(this,K,e.state),this.hasListeners()&&(r==null||r.removeObserver(this),e.addObserver(this))},Se=function(e){xe.batch(()=>{e.listeners&&this.listeners.forEach(r=>{r(s(this,v))}),s(this,C).getQueryCache().notify({query:s(this,a),type:"observerResultsUpdated"})})},Ce);function We(t,e){return E(e.enabled,t)!==!1&&t.state.data===void 0&&!(t.state.status==="error"&&e.retryOnMount===!1)}function Re(t,e){return We(t,e)||t.state.data!==void 0&&oe(t,e,e.refetchOnMount)}function oe(t,e,r){if(E(e.enabled,t)!==!1){const i=typeof r=="function"?r(t):r;return i==="always"||i!==!1&&he(t,e)}return!1}function ge(t,e,r,i){return(t!==e||E(i.enabled,t)===!1)&&(!r.suspense||t.state.status!=="error")&&he(t,r)}function he(t,e){return E(e.enabled,t)!==!1&&t.isStaleByTime(J(e.staleTime,t))}function Je(t,e){return!Y(t.getCurrentResult(),e)}var Oe=x.createContext(!1),Ge=()=>x.useContext(Oe);Oe.Provider;function Xe(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}var Ye=x.createContext(Xe()),Ze=()=>x.useContext(Ye),et=(t,e)=>{(t.suspense||t.throwOnError||t.experimental_prefetchInRender)&&(e.isReset()||(t.retryOnMount=!1))},tt=t=>{x.useEffect(()=>{t.clearReset()},[t])},st=({result:t,errorResetBoundary:e,throwOnError:r,query:i,suspense:d})=>t.isError&&!e.isReset()&&!t.isFetching&&i&&(d&&t.data===void 0||Be(r,[t.error,i])),rt=t=>{const e=t.staleTime;t.suspense&&(t.staleTime=typeof e=="function"?(...r)=>Math.max(e(...r),1e3):Math.max(e??1e3,1e3),typeof t.gcTime=="number"&&(t.gcTime=Math.max(t.gcTime,1e3)))},it=(t,e)=>t.isLoading&&t.isFetching&&!e,at=(t,e)=>(t==null?void 0:t.suspense)&&e.isPending,ve=(t,e,r)=>e.fetchOptimistic(t).catch(()=>{r.clearReset()});function nt(t,e,r){var l,j,m,U,b;const i=Qe(),d=Ge(),c=Ze(),n=i.defaultQueryOptions(t);(j=(l=i.getDefaultOptions().queries)==null?void 0:l._experimental_beforeQuery)==null||j.call(l,n),n._optimisticResults=d?"isRestoring":"optimistic",rt(n),et(n,c),tt(c);const S=!i.getQueryCache().get(n.queryHash),[p]=x.useState(()=>new e(i,n)),R=p.getOptimisticResult(n),O=!d&&t.subscribed!==!1;if(x.useSyncExternalStore(x.useCallback(o=>{const T=O?p.subscribe(xe.batchCalls(o)):ye;return p.updateResult(),T},[p,O]),()=>p.getCurrentResult(),()=>p.getCurrentResult()),x.useEffect(()=>{p.setOptions(n,{listeners:!1})},[n,p]),at(n,R))throw ve(n,p,c);if(st({result:R,errorResetBoundary:c,throwOnError:n.throwOnError,query:i.getQueryCache().get(n.queryHash),suspense:n.suspense}))throw R.error;if((U=(m=i.getDefaultOptions().queries)==null?void 0:m._experimental_afterQuery)==null||U.call(m,n,R),n.experimental_prefetchInRender&&!Z&&it(R,d)){const o=S?ve(n,p,c):(b=i.getQueryCache().get(n.queryHash))==null?void 0:b.promise;o==null||o.catch(ye).finally(()=>{p.updateResult()})}return n.notifyOnChangeProps?R:p.trackResult(R)}function ot(t,e){return nt(t,Ve)}function wt(){const{t}=Fe(),{hasAccessByCodes:e}=Ae(),{data:r}=ot({queryKey:["role-menu"],queryFn:async()=>{const b=await Le();return b==null?void 0:b.result.map(o=>({...o,title:o.name,key:o.id}))},initialData:[]}),i=je({mutationFn:_e}),[d,c]=x.useState(!1),[n,S]=x.useState(""),[p,R]=x.useState({}),O=x.useRef(null),l=async(b,o)=>{var D,Q;const T=await i.mutateAsync(b);await((D=o==null?void 0:o.reload)==null?void 0:D.call(o)),(Q=window.$message)==null||Q.success(`${t("common.deleteSuccess")} userId = ${T.result}`)},j=[...$e(t),{title:t("common.action"),valueType:"option",key:"option",width:120,fixed:"right",render:(b,o,T,D)=>[F.jsx(be,{type:"link",size:"small",disabled:!e(X.update),onClick:async()=>{const Q=await Ue({id:o.id});c(!0),S(t("system.role.editRole")),R({...o,menus:Q.result})},children:t("common.edit")},"editable"),F.jsx(Ne,{title:t("common.confirmDelete"),onConfirm:()=>l(o.id,D),okText:t("common.confirm"),cancelText:t("common.cancel"),children:F.jsx(be,{type:"link",size:"small",disabled:!e(X.delete),children:t("common.delete")})},"delete")]}],m=()=>{c(!1),R({})},U=()=>{var b;(b=O.current)==null||b.reload()};return F.jsxs(He,{className:"h-full",children:[F.jsx(ze,{columns:j,actionRef:O,request:async b=>{const o=await ke(b);return{...o,data:o.result.list,total:o.result.total}},headerTitle:`${t("common.menu.role")} （${t("common.demoOnly")}）`,toolBarRender:()=>[F.jsx(qe,{icon:F.jsx(Ke,{}),type:"primary",disabled:!e(X.add),onClick:()=>{c(!0),S(t("system.role.addRole"))},children:t("common.add")},"add-role")]}),F.jsx(Pe,{title:n,open:d,onCloseChange:m,detailData:p,refreshTable:U,treeData:Me(r||[])})]})}export{wt as default};
