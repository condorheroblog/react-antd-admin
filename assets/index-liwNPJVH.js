import{aC as p,aP as H,aB as pe,aU as he,p as ge,aA as W,aT as we,b9 as be,r as Ce,D as xe,aY as Re,aD as L,aE as w}from"./antd-bHmztw5J.js";import{u as $e,d as ye,h as We,o as _e}from"./index-BSdwXTWa.js";import{R as V,a as d}from"./react-B2eEhSVY.js";import{j as f}from"./index-Cu2kO6lS.js";import{B as ze}from"./BaseForm-DVyki7v_.js";var Se=typeof process<"u"&&process.versions!=null&&process.versions.node!=null,Fe=function(){return typeof window<"u"&&typeof window.document<"u"&&typeof window.matchMedia<"u"&&!Se},ke=function(m){return H({},m.componentCls,{"&-sidebar-dragger":{width:"5px",cursor:"ew-resize",padding:"4px 0 0",borderTop:"1px solid transparent",position:"absolute",top:0,left:0,bottom:0,zIndex:100,backgroundColor:"transparent","&-min-disabled":{cursor:"w-resize"},"&-max-disabled":{cursor:"e-resize"}}})};function De(l){return $e("DrawerForm",function(m){var h=p(p({},m),{},{componentCls:".".concat(l)});return[ke(h)]})}var Me=["children","trigger","onVisibleChange","drawerProps","onFinish","submitTimeout","title","width","resize","onOpenChange","visible","open"];function Ee(l){var m,h,Q=l.children,b=l.trigger,C=l.onVisibleChange,i=l.drawerProps,D=l.onFinish,x=l.submitTimeout,Z=l.title,_=l.width,c=l.resize,z=l.onOpenChange,S=l.visible,N=l.open,s=pe(l,Me);he(!s.footer||!(i!=null&&i.footer),"DrawerForm 是一个 ProForm 的特殊布局，如果想自定义按钮，请使用 submit.render 自定义。");var o=V.useMemo(function(){var t,e,r,n={onResize:function(){},maxWidth:Fe()?window.innerWidth*.8:void 0,minWidth:300};return typeof c=="boolean"?c?n:{}:ye({onResize:(t=c==null?void 0:c.onResize)!==null&&t!==void 0?t:n.onResize,maxWidth:(e=c==null?void 0:c.maxWidth)!==null&&e!==void 0?e:n.maxWidth,minWidth:(r=c==null?void 0:c.minWidth)!==null&&r!==void 0?r:n.minWidth})},[c]),R=d.useContext(ge.ConfigContext),U=R.getPrefixCls("pro-form-drawer"),A=De(U),ee=A.wrapSSR,G=A.hashId,M=function(e){return"".concat(U,"-").concat(e," ").concat(G)},re=d.useState([]),ne=W(re,2),oe=ne[1],te=d.useState(!1),X=W(te,2),P=X[0],T=X[1],ie=d.useState(!1),Y=W(ie,2),j=Y[0],O=Y[1],ae=d.useState(_||(c?o==null?void 0:o.minWidth:800)),q=W(ae,2),I=q[0],F=q[1],le=we(!!S,{value:N||S,onChange:z||C}),J=W(le,2),$=J[0],g=J[1],k=d.useRef(null),se=d.useCallback(function(t){k.current===null&&t&&oe([]),k.current=t},[]),y=d.useRef(),ue=d.useCallback(function(){var t,e,r,n=(t=(e=(r=s.formRef)===null||r===void 0?void 0:r.current)!==null&&e!==void 0?e:s.form)!==null&&t!==void 0?t:y.current;n&&i!==null&&i!==void 0&&i.destroyOnClose&&n.resetFields()},[i==null?void 0:i.destroyOnClose,s.form,s.formRef]);d.useEffect(function(){$&&(N||S)&&(z==null||z(!0),C==null||C(!0)),j&&F(o==null?void 0:o.minWidth)},[S,$,j]),d.useImperativeHandle(s.formRef,function(){return y.current},[y.current]);var de=d.useMemo(function(){return b?V.cloneElement(b,p(p({key:"trigger"},b.props),{},{onClick:function(){var t=L(w().mark(function r(n){var u,a;return w().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:g(!$),O(!Object.keys(o)),(u=b.props)===null||u===void 0||(a=u.onClick)===null||a===void 0||a.call(u,n);case 3:case"end":return v.stop()}},r)}));function e(r){return t.apply(this,arguments)}return e}()})):null},[g,b,$,O,j]),ce=d.useMemo(function(){var t,e,r,n,u;return s.submitter===!1?!1:be({searchConfig:{submitText:(t=(e=R.locale)===null||e===void 0||(e=e.Modal)===null||e===void 0?void 0:e.okText)!==null&&t!==void 0?t:"确认",resetText:(r=(n=R.locale)===null||n===void 0||(n=n.Modal)===null||n===void 0?void 0:n.cancelText)!==null&&r!==void 0?r:"取消"},resetButtonProps:{preventDefault:!0,disabled:x?P:void 0,onClick:function(B){var v;g(!1),i==null||(v=i.onClose)===null||v===void 0||v.call(i,B)}}},(u=s.submitter)!==null&&u!==void 0?u:{})},[s.submitter,(m=R.locale)===null||m===void 0||(m=m.Modal)===null||m===void 0?void 0:m.okText,(h=R.locale)===null||h===void 0||(h=h.Modal)===null||h===void 0?void 0:h.cancelText,x,P,g,i]),ve=d.useCallback(function(t,e){return f.jsxs(f.Fragment,{children:[t,k.current&&e?f.jsx(V.Fragment,{children:Ce.createPortal(e,k.current)},"submitter"):e]})},[]),fe=We(function(){var t=L(w().mark(function e(r){var n,u,a;return w().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return n=D==null?void 0:D(r),x&&n instanceof Promise&&(T(!0),u=setTimeout(function(){return T(!1)},x),n.finally(function(){clearTimeout(u),T(!1)})),v.next=4,n;case 4:return a=v.sent,a&&g(!1),v.abrupt("return",a);case 7:case"end":return v.stop()}},e)}));return function(e){return t.apply(this,arguments)}}()),me=_e($,C),E=d.useCallback(function(t){var e,r,n=(document.body.offsetWidth||1e3)-(t.clientX-document.body.offsetLeft),u=(e=o==null?void 0:o.minWidth)!==null&&e!==void 0?e:_||800,a=(r=o==null?void 0:o.maxWidth)!==null&&r!==void 0?r:window.innerWidth*.8;if(n<u){F(u);return}if(n>a){F(a);return}F(n)},[o==null?void 0:o.maxWidth,o==null?void 0:o.minWidth,_]),K=d.useCallback(function(){document.removeEventListener("mousemove",E),document.removeEventListener("mouseup",K)},[E]);return ee(f.jsxs(f.Fragment,{children:[f.jsxs(xe,p(p(p({title:Z,width:I},i),me),{},{afterOpenChange:function(e){var r;e||ue(),i==null||(r=i.afterOpenChange)===null||r===void 0||r.call(i,e)},onClose:function(e){var r;x&&P||(g(!1),i==null||(r=i.onClose)===null||r===void 0||r.call(i,e))},footer:s.submitter!==!1&&f.jsx("div",{ref:se,style:{display:"flex",justifyContent:"flex-end"}}),children:[c?f.jsx("div",{className:Re(M("sidebar-dragger"),G,H(H({},M("sidebar-dragger-min-disabled"),I===(o==null?void 0:o.minWidth)),M("sidebar-dragger-max-disabled"),I===(o==null?void 0:o.maxWidth))),onMouseDown:function(e){var r;o==null||(r=o.onResize)===null||r===void 0||r.call(o),e.stopPropagation(),e.preventDefault(),document.addEventListener("mousemove",E),document.addEventListener("mouseup",K),O(!0)}}):null,f.jsx(f.Fragment,{children:f.jsx(ze,p(p({formComponentType:"DrawerForm",layout:"vertical"},s),{},{formRef:y,onInit:function(e,r){var n;s.formRef&&(s.formRef.current=r),s==null||(n=s.onInit)===null||n===void 0||n.call(s,e,r),y.current=r},submitter:ce,onFinish:function(){var t=L(w().mark(function e(r){var n;return w().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,fe(r);case 2:return n=a.sent,a.abrupt("return",n);case 4:case"end":return a.stop()}},e)}));return function(e){return t.apply(this,arguments)}}(),contentRender:ve,children:Q}))})]})),de]}))}export{Ee as D,Fe as i};
