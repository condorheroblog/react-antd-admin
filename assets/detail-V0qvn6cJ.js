var ve=e=>{throw TypeError(e)};var ie=(e,t,r)=>t.has(e)||ve("Cannot "+r);var p=(e,t,r)=>(ie(e,t,"read from private field"),r?r.call(e):t.get(e)),L=(e,t,r)=>t.has(e)?ve("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),A=(e,t,r,i)=>(ie(e,t,"write to private field"),i?i.call(e,r):t.set(e,r),r),K=(e,t,r)=>(ie(e,t,"access private method"),r);import{u as Le,j as f,v as Ae,y as Ke,M as be,N as Ne,J as Ce,K as Ve,r as V}from"./index-GUIPP7IA.js";import{r as c,R as J,d as Be}from"./react-BBS6oWoz.js";import{aw as Ue,aW as qe,as as Ge,al as Re,aq as Fe,ar as R,aC as le,aH as He,ab as Je,ap as H,aG as Qe,D as Xe,aM as Ye,at as ae,au as N,ao as ge}from"./antd-C28nsxeG.js";import{c as Ze,r as et,u as tt,d as rt,h as nt,o as ot}from"./index-DatpMunB.js";import{P as st,m as it,B as at,W as xe,a as lt}from"./BaseForm-DZRmTTKq.js";const ut=[{label:"展开所有 / 折叠所有",value:"expandAll"},{label:"选择所有 / 取消所有",value:"checkAll"}],{Search:dt}=Ge;function ue(e,t){let r;for(let i=0;i<t.length;i++){const u=t[i];u.children&&(u.children.some(v=>v.id===e)?r=u.id:ue(e,u.children)&&(r=ue(e,u.children)))}return r}function ct({treeData:e,value:t,onChange:r}){const[i,u]=c.useState([]),[v,s]=c.useState(""),[w,y]=c.useState([]),[O,b]=c.useState(!0),{t:m}=Le(),_=h=>{r==null||r(h)},I=h=>{u(h),b(!1)},E=c.useMemo(()=>{const h=[],k=T=>{for(let P=0;P<T.length;P++){const j=T[P];h.push({id:j.id,title:j.title}),j.children&&k(j.children)}};return k(e),h},[e]),g=h=>{const{value:k}=h.target,T=E.map(P=>m(P.title).includes(k)?ue(P.id,e):null).filter((P,j,B)=>!!(P&&B.indexOf(P)===j));u(T),s(k),b(!0)},l=h=>{y(h)};return c.useEffect(()=>{w.includes("expandAll")?u(E.map(h=>h.id)):u([]),w.includes("checkAll")?r==null||r(E.map(h=>h.id)):r==null||r([])},[w,E]),f.jsxs(f.Fragment,{children:[f.jsx(dt,{className:"mb-3",placeholder:"请输入菜单进行搜索",allowClear:!0,value:v,onChange:g}),f.jsx(Ue.Group,{options:ut,value:w,rootClassName:"flex justify-between items-center mb-3",onChange:l}),f.jsx(qe,{checkable:!0,blockNode:!0,defaultExpandAll:!0,titleRender:h=>m(h.title),onExpand:I,expandedKeys:i,autoExpandParent:O,fieldNames:{key:"id"},checkedKeys:t,treeData:e,onCheck:_})]})}var ft=typeof process<"u"&&process.versions!=null&&process.versions.node!=null,mt=function(){return typeof process<"u",typeof window<"u"&&typeof window.document<"u"&&typeof window.matchMedia<"u"&&!ft},pt=["fieldProps","options","radioType","layout","proFieldProps","valueEnum"],ht=J.forwardRef(function(e,t){var r=e.fieldProps,i=e.options,u=e.radioType,v=e.layout,s=e.proFieldProps,w=e.valueEnum,y=Fe(e,pt);return f.jsx(st,R(R({valueType:u==="button"?"radioButton":"radio",ref:t,valueEnum:et(w,void 0)},y),{},{fieldProps:R({options:i,layout:v},r),proFieldProps:s,filedConfig:{customLightMode:!0}}))}),vt=J.forwardRef(function(e,t){var r=e.fieldProps,i=e.children;return f.jsx(Re,R(R({},r),{},{ref:t,children:i}))}),bt=Ze(vt,{valuePropName:"checked",ignoreWidth:!0}),Z=bt;Z.Group=ht;Z.Button=Re.Button;Z.displayName="ProFormComponent";var gt=function(t){return le({},t.componentCls,{"&-sidebar-dragger":{width:"5px",cursor:"ew-resize",padding:"4px 0 0",borderTop:"1px solid transparent",position:"absolute",top:0,left:0,bottom:0,zIndex:100,backgroundColor:"transparent","&-min-disabled":{cursor:"w-resize"},"&-max-disabled":{cursor:"e-resize"}}})};function xt(e){return tt("DrawerForm",function(t){var r=R(R({},t),{},{componentCls:".".concat(e)});return[gt(r)]})}var wt=["children","trigger","onVisibleChange","drawerProps","onFinish","submitTimeout","title","width","resize","onOpenChange","visible","open"];function yt(e){var t,r,i=e.children,u=e.trigger,v=e.onVisibleChange,s=e.drawerProps,w=e.onFinish,y=e.submitTimeout,O=e.title,b=e.width,m=e.resize,_=e.onOpenChange,I=e.visible,E=e.open,g=Fe(e,wt);He(!g.footer||!(s!=null&&s.footer),"DrawerForm 是一个 ProForm 的特殊布局，如果想自定义按钮，请使用 submit.render 自定义。");var l=J.useMemo(function(){var d,n,o,a={onResize:function(){},maxWidth:mt()?window.innerWidth*.8:void 0,minWidth:300};return typeof m=="boolean"?m?a:{}:rt({onResize:(d=m==null?void 0:m.onResize)!==null&&d!==void 0?d:a.onResize,maxWidth:(n=m==null?void 0:m.maxWidth)!==null&&n!==void 0?n:a.maxWidth,minWidth:(o=m==null?void 0:m.minWidth)!==null&&o!==void 0?o:a.minWidth})},[m]),h=c.useContext(Je.ConfigContext),k=h.getPrefixCls("pro-form-drawer"),T=xt(k),P=T.wrapSSR,j=T.hashId,B=function(n){return"".concat(k,"-").concat(n," ").concat(j)},Pe=c.useState([]),Se=H(Pe,2),je=Se[1],Me=c.useState(!1),ce=H(Me,2),ee=ce[0],te=ce[1],We=c.useState(!1),fe=H(We,2),re=fe[0],ne=fe[1],Oe=c.useState(b||(m?l==null?void 0:l.minWidth:800)),me=H(Oe,2),oe=me[0],Q=me[1],ke=Qe(!!I,{value:E||I,onChange:_||v}),pe=H(ke,2),U=pe[0],D=pe[1],X=c.useRef(null),$e=c.useCallback(function(d){X.current===null&&d&&je([]),X.current=d},[]),q=c.useRef(),ze=c.useCallback(function(){var d,n,o,a=(d=(n=(o=g.formRef)===null||o===void 0?void 0:o.current)!==null&&n!==void 0?n:g.form)!==null&&d!==void 0?d:q.current;a&&s!==null&&s!==void 0&&s.destroyOnClose&&a.resetFields()},[s==null?void 0:s.destroyOnClose,g.form,g.formRef]);c.useEffect(function(){U&&(E||I)&&(_==null||_(!0),v==null||v(!0)),re&&Q(l==null?void 0:l.minWidth)},[I,U,re]),c.useImperativeHandle(g.formRef,function(){return q.current},[q.current]);var Ee=c.useMemo(function(){return u?J.cloneElement(u,R(R({key:"trigger"},u.props),{},{onClick:function(){var d=ae(N().mark(function o(a){var F,x;return N().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:D(!U),ne(!Object.keys(l)),(F=u.props)===null||F===void 0||(x=F.onClick)===null||x===void 0||x.call(F,a);case 3:case"end":return S.stop()}},o)}));function n(o){return d.apply(this,arguments)}return n}()})):null},[D,u,U,ne,re]),Te=c.useMemo(function(){var d,n,o,a;return g.submitter===!1?!1:it({searchConfig:{submitText:(d=(n=h.locale)===null||n===void 0||(n=n.Modal)===null||n===void 0?void 0:n.okText)!==null&&d!==void 0?d:"确认",resetText:(o=(a=h.locale)===null||a===void 0||(a=a.Modal)===null||a===void 0?void 0:a.cancelText)!==null&&o!==void 0?o:"取消"},resetButtonProps:{preventDefault:!0,disabled:y?ee:void 0,onClick:function(x){var G;D(!1),s==null||(G=s.onClose)===null||G===void 0||G.call(s,x)}}},g.submitter)},[g.submitter,(t=h.locale)===null||t===void 0||(t=t.Modal)===null||t===void 0?void 0:t.okText,(r=h.locale)===null||r===void 0||(r=r.Modal)===null||r===void 0?void 0:r.cancelText,y,ee,D,s]),_e=c.useCallback(function(d,n){return f.jsxs(f.Fragment,{children:[d,X.current&&n?f.jsx(J.Fragment,{children:Be.createPortal(n,X.current)},"submitter"):n]})},[]),Ie=nt(function(){var d=ae(N().mark(function n(o){var a,F,x;return N().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return a=w==null?void 0:w(o),y&&a instanceof Promise&&(te(!0),F=setTimeout(function(){return te(!1)},y),a.finally(function(){clearTimeout(F),te(!1)})),S.next=4,a;case 4:return x=S.sent,x&&D(!1),S.abrupt("return",x);case 7:case"end":return S.stop()}},n)}));return function(n){return d.apply(this,arguments)}}()),De=ot(U,v),se=c.useCallback(function(d){var n,o,a=(document.body.offsetWidth||1e3)-(d.clientX-document.body.offsetLeft),F=(n=l==null?void 0:l.minWidth)!==null&&n!==void 0?n:b||800,x=(o=l==null?void 0:l.maxWidth)!==null&&o!==void 0?o:window.innerWidth*.8;if(a<F){Q(F);return}if(a>x){Q(x);return}Q(a)},[l==null?void 0:l.maxWidth,l==null?void 0:l.minWidth,b]),he=c.useCallback(function(){document.removeEventListener("mousemove",se),document.removeEventListener("mouseup",he)},[se]);return P(f.jsxs(f.Fragment,{children:[f.jsxs(Xe,R(R(R({title:O,width:oe},s),De),{},{afterOpenChange:function(n){var o;n||ze(),s==null||(o=s.afterOpenChange)===null||o===void 0||o.call(s,n)},onClose:function(n){var o;y&&ee||(D(!1),s==null||(o=s.onClose)===null||o===void 0||o.call(s,n))},footer:g.submitter!==!1&&f.jsx("div",{ref:$e,style:{display:"flex",justifyContent:"flex-end"}}),children:[m?f.jsx("div",{className:Ye(B("sidebar-dragger"),j,le(le({},B("sidebar-dragger-min-disabled"),oe===(l==null?void 0:l.minWidth)),B("sidebar-dragger-max-disabled"),oe===(l==null?void 0:l.maxWidth))),onMouseDown:function(n){var o;l==null||(o=l.onResize)===null||o===void 0||o.call(l),n.stopPropagation(),n.preventDefault(),document.addEventListener("mousemove",se),document.addEventListener("mouseup",he),ne(!0)}}):null,f.jsx(f.Fragment,{children:f.jsx(at,R(R({formComponentType:"DrawerForm",layout:"vertical"},g),{},{formRef:q,onInit:function(n,o){var a;g.formRef&&(g.formRef.current=o),g==null||(a=g.onInit)===null||a===void 0||a.call(g,n,o),q.current=o},submitter:Te,onFinish:function(){var d=ae(N().mark(function n(o){var a;return N().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.next=2,Ie(o);case 2:return a=x.sent,x.abrupt("return",a);case 4:case"end":return x.stop()}},n)}));return function(n){return d.apply(this,arguments)}}(),contentRender:_e,children:i}))})]})),Ee]}))}var $,z,C,M,W,Y,de,ye,Ct=(ye=class extends Ae{constructor(t,r){super();L(this,W);L(this,$);L(this,z);L(this,C);L(this,M);A(this,$,t),this.setOptions(r),this.bindMethods(),K(this,W,Y).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){var i;const r=this.options;this.options=p(this,$).defaultMutationOptions(t),Ke(this.options,r)||p(this,$).getMutationCache().notify({type:"observerOptionsUpdated",mutation:p(this,C),observer:this}),r!=null&&r.mutationKey&&this.options.mutationKey&&be(r.mutationKey)!==be(this.options.mutationKey)?this.reset():((i=p(this,C))==null?void 0:i.state.status)==="pending"&&p(this,C).setOptions(this.options)}onUnsubscribe(){var t;this.hasListeners()||(t=p(this,C))==null||t.removeObserver(this)}onMutationUpdate(t){K(this,W,Y).call(this),K(this,W,de).call(this,t)}getCurrentResult(){return p(this,z)}reset(){var t;(t=p(this,C))==null||t.removeObserver(this),A(this,C,void 0),K(this,W,Y).call(this),K(this,W,de).call(this)}mutate(t,r){var i;return A(this,M,r),(i=p(this,C))==null||i.removeObserver(this),A(this,C,p(this,$).getMutationCache().build(p(this,$),this.options)),p(this,C).addObserver(this),p(this,C).execute(t)}},$=new WeakMap,z=new WeakMap,C=new WeakMap,M=new WeakMap,W=new WeakSet,Y=function(){var r;const t=((r=p(this,C))==null?void 0:r.state)??Ne();A(this,z,{...t,isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset})},de=function(t){Ce.batch(()=>{var r,i,u,v,s,w,y,O;if(p(this,M)&&this.hasListeners()){const b=p(this,z).variables,m=p(this,z).context;(t==null?void 0:t.type)==="success"?((i=(r=p(this,M)).onSuccess)==null||i.call(r,t.data,b,m),(v=(u=p(this,M)).onSettled)==null||v.call(u,t.data,null,b,m)):(t==null?void 0:t.type)==="error"&&((w=(s=p(this,M)).onError)==null||w.call(s,t.error,b,m),(O=(y=p(this,M)).onSettled)==null||O.call(y,void 0,t.error,b,m))}this.listeners.forEach(b=>{b(p(this,z))})})},ye);function Rt(e,t){return typeof e=="function"?e(...t):!!e}function Ft(){}function we(e,t){const r=Ve(),[i]=c.useState(()=>new Ct(r,e));c.useEffect(()=>{i.setOptions(e)},[i,e]);const u=c.useSyncExternalStore(c.useCallback(s=>i.subscribe(Ce.batchCalls(s)),[i]),()=>i.getCurrentResult(),()=>i.getCurrentResult()),v=c.useCallback((s,w)=>{i.mutate(s,w).catch(Ft)},[i]);if(u.error&&Rt(i.options.throwOnError,[u.error]))throw u.error;return{...u,mutate:v,mutateAsync:u.mutate}}function Et(e){return V.get("role-list",{searchParams:e,ignoreLoading:!0}).json()}function Pt(e){return V.post("role-item",{json:e,ignoreLoading:!0}).json()}function St(e){return V.put("role-item",{json:e,ignoreLoading:!0}).json()}function Tt(e){return V.delete("role-item",{json:e,ignoreLoading:!0}).json()}function _t(){return V.get("role-menu",{ignoreLoading:!0}).json()}function It(e){return V.get("role-menu-ids",{searchParams:e,ignoreLoading:!1}).json()}function jt({title:e,open:t,onCloseChange:r,detailData:i,treeData:u,refreshTable:v}){const[s]=ge.useForm(),w=we({mutationFn:Pt}),y=we({mutationFn:St}),O=async b=>{var m;return i.id?await y.mutateAsync(b):await w.mutateAsync(b),v==null||v(),(m=window.$message)==null||m.success("操作成功"),!0};return c.useEffect(()=>{t&&s.setFieldsValue(i)},[t]),f.jsxs(yt,{title:e,open:t,onOpenChange:b=>{b===!1&&r()},resize:{onResize(){},maxWidth:window.innerWidth*.8,minWidth:500},labelCol:{span:6},wrapperCol:{span:24},layout:"horizontal",form:s,autoFocusFirstInput:!0,drawerProps:{destroyOnClose:!0},onFinish:O,initialValues:{status:1,menus:[]},children:[f.jsx(xe,{allowClear:!0,rules:[{required:!0,message:"请输入角色名称!"}],width:"md",name:"name",label:"角色名称",tooltip:"最长为 24 位",placeholder:"请输入角色名称"}),f.jsx(xe,{allowClear:!0,rules:[{required:!0,message:"请输入角色标识!"}],width:"md",name:"code",label:"角色标识",placeholder:"请输入角色标识"}),f.jsx(Z.Group,{name:"status",label:"角色状态",radioType:"button",options:[{label:"启用",value:1},{label:"停用",value:0}]}),f.jsx(lt,{allowClear:!0,width:"md",name:"remark",label:"备注",placeholder:"请输入备注"}),f.jsx("div",{children:f.jsx(ge.Item,{name:"menus",label:"菜单分配",children:f.jsx(ct,{treeData:u})})})]})}const Dt=Object.freeze(Object.defineProperty({__proto__:null,Detail:jt},Symbol.toStringTag,{value:"Module"}));export{yt as D,jt as a,It as b,Tt as c,_t as d,Dt as e,Et as f,mt as i,Ft as n,Rt as s,we as u};
