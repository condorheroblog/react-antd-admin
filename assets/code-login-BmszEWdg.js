import{j as e,u as G,B as M}from"./index-DhXLOoLU.js";import{M as $}from"./rules-ChV9k-MN.js";import{R as q,a as c}from"./react-UQ1dNgW8.js";import{F as A}from"./form-mode-context-D78nou8v.js";import{aH as p,aS as F,aQ as H,aP as u,I as O,B as N,aW as C,aX as T,S as V,T as U,Z as W,bk as _}from"./antd-BreSrAtA.js";import{j as Q}from"./index-DznfrGw4.js";import"./faker-Dcf0Eyuj.js";var X=["rules","name","phoneName","fieldProps","onTiming","captchaTextRender","captchaProps"],Z=q.forwardRef(function(t,d){var v=p.useFormInstance(),r=c.useState(t.countDown||60),g=F(r,2),h=g[0],i=g[1],x=c.useState(!1),I=F(x,2),y=I[0],f=I[1],k=c.useState(),S=F(k,2),L=S[0],b=S[1];t.rules,t.name;var j=t.phoneName,l=t.fieldProps,w=t.onTiming,P=t.captchaTextRender,B=P===void 0?function(n,o){return n?"".concat(o," 秒后重新获取"):"获取验证码"}:P,E=t.captchaProps,D=H(t,X),R=function(){var n=C(T().mark(function o(m){return T().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,b(!0),s.next=4,D.onGetCaptcha(m);case 4:b(!1),f(!0),s.next=13;break;case 8:s.prev=8,s.t0=s.catch(0),f(!1),b(!1),console.log(s.t0);case 13:case"end":return s.stop()}},o,null,[[0,8]])}));return function(m){return n.apply(this,arguments)}}();return c.useImperativeHandle(d,function(){return{startTiming:function(){return f(!0)},endTiming:function(){return f(!1)}}}),c.useEffect(function(){var n=0,o=t.countDown;return y&&(n=window.setInterval(function(){i(function(m){return m<=1?(f(!1),clearInterval(n),o||60):m-1})},1e3)),function(){return clearInterval(n)}},[y]),c.useEffect(function(){w&&w(h)},[h,w]),e.jsxs("div",{style:u(u({},l==null?void 0:l.style),{},{display:"flex",alignItems:"center"}),ref:d,children:[e.jsx(O,u(u({},l),{},{style:u({flex:1,transition:"width .3s",marginRight:8},l==null?void 0:l.style)})),e.jsx(N,u(u({style:{display:"block"},disabled:y,loading:L},E),{},{onClick:C(T().mark(function n(){var o;return T().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(a.prev=0,!j){a.next=9;break}return a.next=4,v.validateFields([j].flat(1));case 4:return o=v.getFieldValue([j].flat(1)),a.next=7,R(o);case 7:a.next=11;break;case 9:return a.next=11,R("");case 11:a.next=16;break;case 13:a.prev=13,a.t0=a.catch(0),console.log(a.t0);case 16:case"end":return a.stop()}},n,null,[[0,13]])})),children:B(y,h)}))]})}),z=Q(Z);const{Title:J}=U,K={phoneNumber:"",captcha:""};function ie(){const[t,d]=c.useState(!1),[v]=p.useForm(),{t:r}=G(),{setFormMode:g}=c.useContext(A),h=async()=>{d(!0),setTimeout(()=>{var i;d(!1),(i=window.$message)==null||i.success(r("common.success"))},1e3)};return e.jsxs(e.Fragment,{children:[e.jsx(V,{direction:"vertical",children:e.jsx(J,{level:3,children:r("authority.codeLogin")})}),e.jsxs(p,{name:"codeLoginForm",form:v,layout:"vertical",initialValues:K,onFinish:h,children:[e.jsx(p.Item,{label:r("authority.mobile"),name:"phoneNumber",rules:$(r),children:e.jsx(W,{controls:!1,className:"w-full",placeholder:r("form.mobile.required")})}),e.jsx(z,{label:r("authority.code"),placeholder:r("form.code.required"),captchaTextRender:(i,x)=>i?r("authority.sendText",{second:x}):r("authority.sendCode"),onGetCaptcha:()=>{var i;return(i=window.$message)==null||i.success(r("common.success")),Promise.resolve()},rules:[{required:!0}],phoneName:"phoneNumber",name:"captcha"}),e.jsx(p.Item,{children:e.jsx(N,{block:!0,type:"primary",htmlType:"submit",loading:t,children:r("authority.login")})}),e.jsx("div",{className:"text-sm text-center",children:e.jsx(M,{type:"link",icon:e.jsx(_,{}),className:"px-1",onPointerDown:()=>{g("login")},children:r("common.back")})})]})]})}export{ie as CodeLogin};
