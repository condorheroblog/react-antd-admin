import{aB as Z,aU as ee,p as re,aA as S,aT as ne,aC as v,b9 as oe,r as te,aD as O,M as le,aE as g}from"./antd-bHmztw5J.js";import{o as ae}from"./index-BSdwXTWa.js";import{a as i,R as I}from"./react-B2eEhSVY.js";import{j as f}from"./index-Cu2kO6lS.js";import{B as ie}from"./BaseForm-DVyki7v_.js";var se=["children","trigger","onVisibleChange","onOpenChange","modalProps","onFinish","submitTimeout","title","width","visible","open"];function me(s){var m,p,V=s.children,h=s.trigger,T=s.onVisibleChange,_=s.onOpenChange,e=s.modalProps,$=s.onFinish,C=s.submitTimeout,B=s.title,A=s.width,k=s.visible,P=s.open,a=Z(s,se);ee(!a.footer||!(e!=null&&e.footer),"ModalForm 是一个 ProForm 的特殊布局，如果想自定义按钮，请使用 submit.render 自定义。");var R=i.useContext(re.ConfigContext),H=i.useState([]),U=S(H,2),G=U[1],L=i.useState(!1),E=S(L,2),y=E[0],w=E[1],W=ne(!!k,{value:P||k,onChange:_||T}),D=S(W,2),F=D[0],d=D[1],M=i.useRef(null),q=i.useCallback(function(o){M.current===null&&o&&G([]),M.current=o},[]),b=i.useRef(),z=i.useCallback(function(){var o,r,n,l=(o=(r=a.form)!==null&&r!==void 0?r:(n=a.formRef)===null||n===void 0?void 0:n.current)!==null&&o!==void 0?o:b.current;l&&e!==null&&e!==void 0&&e.destroyOnClose&&l.resetFields()},[e==null?void 0:e.destroyOnClose,a.form,a.formRef]);i.useImperativeHandle(a.formRef,function(){return b.current},[b.current]),i.useEffect(function(){(P||k)&&(_==null||_(!0),T==null||T(!0))},[k,P]);var J=i.useMemo(function(){return h?I.cloneElement(h,v(v({key:"trigger"},h.props),{},{onClick:function(){var o=O(g().mark(function n(l){var u,t;return g().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:d(!F),(u=h.props)===null||u===void 0||(t=u.onClick)===null||t===void 0||t.call(u,l);case 2:case"end":return c.stop()}},n)}));function r(n){return o.apply(this,arguments)}return r}()})):null},[d,h,F]),K=i.useMemo(function(){var o,r,n,l,u,t,x;return a.submitter===!1?!1:oe({searchConfig:{submitText:(o=(r=e==null?void 0:e.okText)!==null&&r!==void 0?r:(n=R.locale)===null||n===void 0||(n=n.Modal)===null||n===void 0?void 0:n.okText)!==null&&o!==void 0?o:"确认",resetText:(l=(u=e==null?void 0:e.cancelText)!==null&&u!==void 0?u:(t=R.locale)===null||t===void 0||(t=t.Modal)===null||t===void 0?void 0:t.cancelText)!==null&&l!==void 0?l:"取消"},resetButtonProps:{preventDefault:!0,disabled:C?y:void 0,onClick:function(Y){var j;d(!1),e==null||(j=e.onCancel)===null||j===void 0||j.call(e,Y)}}},(x=a.submitter)!==null&&x!==void 0?x:{})},[(m=R.locale)===null||m===void 0||(m=m.Modal)===null||m===void 0?void 0:m.cancelText,(p=R.locale)===null||p===void 0||(p=p.Modal)===null||p===void 0?void 0:p.okText,e,a.submitter,d,y,C]),N=i.useCallback(function(o,r){return f.jsxs(f.Fragment,{children:[o,M.current&&r?f.jsx(I.Fragment,{children:te.createPortal(r,M.current)},"submitter"):r]})},[]),Q=i.useCallback(function(){var o=O(g().mark(function r(n){var l,u,t;return g().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return l=$==null?void 0:$(n),C&&l instanceof Promise&&(w(!0),u=setTimeout(function(){return w(!1)},C),l.finally(function(){clearTimeout(u),w(!1)})),c.next=4,l;case 4:return t=c.sent,t&&d(!1),c.abrupt("return",t);case 7:case"end":return c.stop()}},r)}));return function(r){return o.apply(this,arguments)}}(),[$,d,C]),X=ae(F);return f.jsxs(f.Fragment,{children:[f.jsx(le,v(v(v({title:B,width:A||800},e),X),{},{onCancel:function(r){var n;C&&y||(d(!1),e==null||(n=e.onCancel)===null||n===void 0||n.call(e,r))},afterClose:function(){var r;z(),F&&d(!1),e==null||(r=e.afterClose)===null||r===void 0||r.call(e)},footer:a.submitter!==!1?f.jsx("div",{ref:q,style:{display:"flex",justifyContent:"flex-end"}}):null,children:f.jsx(ie,v(v({formComponentType:"ModalForm",layout:"vertical"},a),{},{onInit:function(r,n){var l;a.formRef&&(a.formRef.current=n),a==null||(l=a.onInit)===null||l===void 0||l.call(a,r,n),b.current=n},formRef:b,submitter:K,onFinish:function(){var o=O(g().mark(function r(n){var l;return g().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Q(n);case 2:return l=t.sent,t.abrupt("return",l);case 4:case"end":return t.stop()}},r)}));return function(r){return o.apply(this,arguments)}}(),contentRender:N,children:V}))})),J]})}export{me as M};
