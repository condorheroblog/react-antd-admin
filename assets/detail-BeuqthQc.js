var I=e=>{throw TypeError(e)};var R=(e,t,s)=>t.has(e)||I("Cannot "+s);var o=(e,t,s)=>(R(e,t,"read from private field"),s?s.call(e):t.get(e)),g=(e,t,s)=>t.has(e)?I("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,s),y=(e,t,s,r)=>(R(e,t,"write to private field"),r?r.call(e,s):t.set(e,s),s),j=(e,t,s)=>(R(e,t,"access private method"),s);import{S as D,G as K,a2 as E,a3 as U,R as A,U as k,r as v,u as z,j as b,a4 as _}from"./index-DoKM0vQ2.js";import{a as w}from"./react-DUVzRXT7.js";import{aH as L}from"./antd-DxuFB7J3.js";import{D as T}from"./index-DLXicDT3.js";import{W as P}from"./BaseForm-BEDfmN7z.js";import{W as G}from"./index-BMCap4-C.js";import{P as V}from"./index-BqUKnovK.js";var d,p,n,l,m,O,M,q,$=(q=class extends D{constructor(t,s){super();g(this,m);g(this,d);g(this,p);g(this,n);g(this,l);y(this,d,t),this.setOptions(s),this.bindMethods(),j(this,m,O).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){var r;const s=this.options;this.options=o(this,d).defaultMutationOptions(t),K(this.options,s)||o(this,d).getMutationCache().notify({type:"observerOptionsUpdated",mutation:o(this,n),observer:this}),s!=null&&s.mutationKey&&this.options.mutationKey&&E(s.mutationKey)!==E(this.options.mutationKey)?this.reset():((r=o(this,n))==null?void 0:r.state.status)==="pending"&&o(this,n).setOptions(this.options)}onUnsubscribe(){var t;this.hasListeners()||(t=o(this,n))==null||t.removeObserver(this)}onMutationUpdate(t){j(this,m,O).call(this),j(this,m,M).call(this,t)}getCurrentResult(){return o(this,p)}reset(){var t;(t=o(this,n))==null||t.removeObserver(this),y(this,n,void 0),j(this,m,O).call(this),j(this,m,M).call(this)}mutate(t,s){var r;return y(this,l,s),(r=o(this,n))==null||r.removeObserver(this),y(this,n,o(this,d).getMutationCache().build(o(this,d),this.options)),o(this,n).addObserver(this),o(this,n).execute(t)}},d=new WeakMap,p=new WeakMap,n=new WeakMap,l=new WeakMap,m=new WeakSet,O=function(){var s;const t=((s=o(this,n))==null?void 0:s.state)??U();y(this,p,{...t,isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset})},M=function(t){A.batch(()=>{var s,r,a,h,i,f,x,C;if(o(this,l)&&this.hasListeners()){const c=o(this,p).variables,u=o(this,p).context;(t==null?void 0:t.type)==="success"?((r=(s=o(this,l)).onSuccess)==null||r.call(s,t.data,c,u),(h=(a=o(this,l)).onSettled)==null||h.call(a,t.data,null,c,u)):(t==null?void 0:t.type)==="error"&&((f=(i=o(this,l)).onError)==null||f.call(i,t.error,c,u),(C=(x=o(this,l)).onSettled)==null||C.call(x,void 0,t.error,c,u))}this.listeners.forEach(c=>{c(o(this,p))})})},q);function B(e,t){return typeof e=="function"?e(...t):!!e}function H(){}function W(e,t){const s=k(),[r]=w.useState(()=>new $(s,e));w.useEffect(()=>{r.setOptions(e)},[r,e]);const a=w.useSyncExternalStore(w.useCallback(i=>r.subscribe(A.batchCalls(i)),[r]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),h=w.useCallback((i,f)=>{r.mutate(i,f).catch(H)},[r]);if(a.error&&B(r.options.throwOnError,[a.error]))throw a.error;return{...a,mutate:h,mutateAsync:a.mutate}}function it(e){return v.get("role-list",{searchParams:e,ignoreLoading:!0}).json()}function Q(e){return v.post("role-item",{json:e,ignoreLoading:!0}).json()}function J(e){return v.put("role-item",{json:e,ignoreLoading:!0}).json()}function nt(e){return v.delete("role-item",{json:e,ignoreLoading:!0}).json()}function at(){return v.get("role-menu",{ignoreLoading:!0}).json()}function ut(e){return v.get("menu-by-role-id",{searchParams:e,ignoreLoading:!1}).json()}function N({title:e,open:t,onCloseChange:s,detailData:r,treeData:a,refreshTable:h}){const{t:i}=z(),[f]=L.useForm(),x=W({mutationFn:Q}),C=W({mutationFn:J}),c=async u=>{var S,F;return r.id?(await C.mutateAsync(u),(S=window.$message)==null||S.success(i("common.updateSuccess"))):(await x.mutateAsync(u),(F=window.$message)==null||F.success(i("common.addSuccess"))),h==null||h(),!0};return w.useEffect(()=>{t&&f.setFieldsValue(r)},[t]),b.jsxs(T,{title:e,open:t,onOpenChange:u=>{u===!1&&s()},resize:{onResize(){},maxWidth:window.innerWidth*.8,minWidth:500},labelCol:{span:6},wrapperCol:{span:24},layout:"horizontal",form:f,autoFocusFirstInput:!0,drawerProps:{destroyOnClose:!0},onFinish:c,initialValues:{status:1,menus:[]},children:[b.jsx(P,{allowClear:!0,rules:[{required:!0}],width:"md",name:"name",label:i("system.role.name"),tooltip:i("form.length",{length:24})}),b.jsx(P,{allowClear:!0,rules:[{required:!0}],width:"md",name:"code",label:i("system.role.id")}),b.jsx(G.Group,{name:"status",label:i("common.status"),radioType:"button",options:[{label:i("common.enabled"),value:1},{label:i("common.deactivated"),value:0}]}),b.jsx(V,{allowClear:!0,width:"md",name:"remark",label:i("common.remark")}),b.jsx(L.Item,{name:"menus",label:i("system.role.assignMenu"),children:b.jsx(_,{treeData:a})})]})}const lt=Object.freeze(Object.defineProperty({__proto__:null,Detail:N},Symbol.toStringTag,{value:"Module"}));export{N as D,it as a,nt as b,at as c,lt as d,ut as f,H as n,B as s,W as u};
