var de=t=>{throw TypeError(t)};var G=(t,e,i)=>e.has(t)||de("Cannot "+i);var s=(t,e,i)=>(G(t,e,"read from private field"),i?i.call(t):e.get(t)),y=(t,e,i)=>e.has(t)?de("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,i),u=(t,e,i,r)=>(G(t,e,"write to private field"),r?r.call(t,i):e.set(t,i),i),f=(t,e,i)=>(G(t,e,"access private method"),i);import{S as we,p as fe,r as T,s as Y,f as J,n as Ie,i as Z,g as pe,t as Te,h as Ee,k as De,l as me,m as xe,o as Qe,u as Fe,j as F,B as be,e as X,q as Be}from"./index-B4D4TeV5.js";import{s as Me,n as ye,u as je,f as Ue,a as ke,D as Pe,b as _e,c as Le}from"./detail-DWzma60Q.js";import{B as Ae}from"./index-BWwRwqwu.js";import{B as He}from"./index-BAR1_apN.js";import{u as $e}from"./index-Dm5XTKLJ.js";import{a as x}from"./react-UQ1dNgW8.js";import{getConstantColumns as ze}from"./constants-OISn2Ihp.js";import{aI as qe,B as Ne,aJ as Ve}from"./antd-BreSrAtA.js";import"./faker-Dcf0Eyuj.js";import"./index-cxV41r0u.js";import"./BaseForm-BBX0u0Gz.js";import"./index-1qU7M37A.js";import"./index-CIISlwv1.js";import"./index-CNQx58s4.js";import"./index-BvDo6lfe.js";import"./index-Vm-Qja3L.js";var C,a,V,v,k,H,B,I,W,$,z,P,_,M,q,h,N,ee,te,se,ie,re,ae,ne,Se,Ce,We=(Ce=class extends we{constructor(e,i){super();y(this,h);y(this,C);y(this,a);y(this,V);y(this,v);y(this,k);y(this,H);y(this,B);y(this,I);y(this,W);y(this,$);y(this,z);y(this,P);y(this,_);y(this,M);y(this,q,new Set);this.options=i,u(this,C,e),u(this,I,null),u(this,B,fe()),this.options.experimental_prefetchInRender||s(this,B).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(i)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(s(this,a).addObserver(this),Re(s(this,a),this.options)?f(this,h,N).call(this):this.updateResult(),f(this,h,ie).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return oe(s(this,a),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return oe(s(this,a),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,f(this,h,re).call(this),f(this,h,ae).call(this),s(this,a).removeObserver(this)}setOptions(e,i){const r=this.options,d=s(this,a);if(this.options=s(this,C).defaultQueryOptions(e),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof T(this.options.enabled,s(this,a))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");f(this,h,ne).call(this),s(this,a).setOptions(this.options),r._defaulted&&!Y(this.options,r)&&s(this,C).getQueryCache().notify({type:"observerOptionsUpdated",query:s(this,a),observer:this});const c=this.hasListeners();c&&ge(s(this,a),d,this.options,r)&&f(this,h,N).call(this),this.updateResult(i),c&&(s(this,a)!==d||T(this.options.enabled,s(this,a))!==T(r.enabled,s(this,a))||J(this.options.staleTime,s(this,a))!==J(r.staleTime,s(this,a)))&&f(this,h,ee).call(this);const n=f(this,h,te).call(this);c&&(s(this,a)!==d||T(this.options.enabled,s(this,a))!==T(r.enabled,s(this,a))||n!==s(this,M))&&f(this,h,se).call(this,n)}getOptimisticResult(e){const i=s(this,C).getQueryCache().build(s(this,C),e),r=this.createResult(i,e);return Je(this,r)&&(u(this,v,r),u(this,H,this.options),u(this,k,s(this,a).state)),r}getCurrentResult(){return s(this,v)}trackResult(e,i){const r={};return Object.keys(e).forEach(d=>{Object.defineProperty(r,d,{configurable:!1,enumerable:!0,get:()=>(this.trackProp(d),i==null||i(d),e[d])})}),r}trackProp(e){s(this,q).add(e)}getCurrentQuery(){return s(this,a)}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){const i=s(this,C).defaultQueryOptions(e),r=s(this,C).getQueryCache().build(s(this,C),i);return r.fetch().then(()=>this.createResult(r,i))}fetch(e){return f(this,h,N).call(this,{...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),s(this,v)))}createResult(e,i){var ue;const r=s(this,a),d=this.options,c=s(this,v),n=s(this,k),S=s(this,H),R=e!==r?e.state:s(this,V),{state:O}=e;let l={...O},j=!1,m;if(i._optimisticResults){const g=this.hasListeners(),L=!g&&Re(e,i),A=g&&ge(e,r,i,d);(L||A)&&(l={...l,...De(O.data,e.options)}),i._optimisticResults==="isRestoring"&&(l.fetchStatus="idle")}let{error:U,errorUpdatedAt:b,status:o}=l;if(i.select&&l.data!==void 0)if(c&&l.data===(n==null?void 0:n.data)&&i.select===s(this,W))m=s(this,$);else try{u(this,W,i.select),m=i.select(l.data),m=me(c==null?void 0:c.data,m,i),u(this,$,m),u(this,I,null)}catch(g){u(this,I,g)}else m=l.data;if(i.placeholderData!==void 0&&m===void 0&&o==="pending"){let g;if(c!=null&&c.isPlaceholderData&&i.placeholderData===(S==null?void 0:S.placeholderData))g=c.data;else if(g=typeof i.placeholderData=="function"?i.placeholderData((ue=s(this,z))==null?void 0:ue.state.data,s(this,z)):i.placeholderData,i.select&&g!==void 0)try{g=i.select(g),u(this,I,null)}catch(L){u(this,I,L)}g!==void 0&&(o="success",m=me(c==null?void 0:c.data,g,i),j=!0)}s(this,I)&&(U=s(this,I),m=s(this,$),b=Date.now(),o="error");const E=l.fetchStatus==="fetching",D=o==="pending",Q=o==="error",ce=D&&E,le=m!==void 0,w={status:o,fetchStatus:l.fetchStatus,isPending:D,isSuccess:o==="success",isError:Q,isInitialLoading:ce,isLoading:ce,data:m,dataUpdatedAt:l.dataUpdatedAt,error:U,errorUpdatedAt:b,failureCount:l.fetchFailureCount,failureReason:l.fetchFailureReason,errorUpdateCount:l.errorUpdateCount,isFetched:l.dataUpdateCount>0||l.errorUpdateCount>0,isFetchedAfterMount:l.dataUpdateCount>R.dataUpdateCount||l.errorUpdateCount>R.errorUpdateCount,isFetching:E,isRefetching:E&&!D,isLoadingError:Q&&!le,isPaused:l.fetchStatus==="paused",isPlaceholderData:j,isRefetchError:Q&&le,isStale:he(e,i),refetch:this.refetch,promise:s(this,B)};if(this.options.experimental_prefetchInRender){const g=K=>{w.status==="error"?K.reject(w.error):w.data!==void 0&&K.resolve(w.data)},L=()=>{const K=u(this,B,w.promise=fe());g(K)},A=s(this,B);switch(A.status){case"pending":e.queryHash===r.queryHash&&g(A);break;case"fulfilled":(w.status==="error"||w.data!==A.value)&&L();break;case"rejected":(w.status!=="error"||w.error!==A.reason)&&L();break}}return w}updateResult(e){const i=s(this,v),r=this.createResult(s(this,a),this.options);if(u(this,k,s(this,a).state),u(this,H,this.options),s(this,k).data!==void 0&&u(this,z,s(this,a)),Y(r,i))return;u(this,v,r);const d={},c=()=>{if(!i)return!0;const{notifyOnChangeProps:n}=this.options,S=typeof n=="function"?n():n;if(S==="all"||!S&&!s(this,q).size)return!0;const p=new Set(S??s(this,q));return this.options.throwOnError&&p.add("error"),Object.keys(s(this,v)).some(R=>{const O=R;return s(this,v)[O]!==i[O]&&p.has(O)})};(e==null?void 0:e.listeners)!==!1&&c()&&(d.listeners=!0),f(this,h,Se).call(this,{...d,...e})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&f(this,h,ie).call(this)}},C=new WeakMap,a=new WeakMap,V=new WeakMap,v=new WeakMap,k=new WeakMap,H=new WeakMap,B=new WeakMap,I=new WeakMap,W=new WeakMap,$=new WeakMap,z=new WeakMap,P=new WeakMap,_=new WeakMap,M=new WeakMap,q=new WeakMap,h=new WeakSet,N=function(e){f(this,h,ne).call(this);let i=s(this,a).fetch(this.options,e);return e!=null&&e.throwOnError||(i=i.catch(Ie)),i},ee=function(){f(this,h,re).call(this);const e=J(this.options.staleTime,s(this,a));if(Z||s(this,v).isStale||!pe(e))return;const r=Te(s(this,v).dataUpdatedAt,e)+1;u(this,P,setTimeout(()=>{s(this,v).isStale||this.updateResult()},r))},te=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(s(this,a)):this.options.refetchInterval)??!1},se=function(e){f(this,h,ae).call(this),u(this,M,e),!(Z||T(this.options.enabled,s(this,a))===!1||!pe(s(this,M))||s(this,M)===0)&&u(this,_,setInterval(()=>{(this.options.refetchIntervalInBackground||Ee.isFocused())&&f(this,h,N).call(this)},s(this,M)))},ie=function(){f(this,h,ee).call(this),f(this,h,se).call(this,f(this,h,te).call(this))},re=function(){s(this,P)&&(clearTimeout(s(this,P)),u(this,P,void 0))},ae=function(){s(this,_)&&(clearInterval(s(this,_)),u(this,_,void 0))},ne=function(){const e=s(this,C).getQueryCache().build(s(this,C),this.options);if(e===s(this,a))return;const i=s(this,a);u(this,a,e),u(this,V,e.state),this.hasListeners()&&(i==null||i.removeObserver(this),e.addObserver(this))},Se=function(e){xe.batch(()=>{e.listeners&&this.listeners.forEach(i=>{i(s(this,v))}),s(this,C).getQueryCache().notify({query:s(this,a),type:"observerResultsUpdated"})})},Ce);function Ke(t,e){return T(e.enabled,t)!==!1&&t.state.data===void 0&&!(t.state.status==="error"&&e.retryOnMount===!1)}function Re(t,e){return Ke(t,e)||t.state.data!==void 0&&oe(t,e,e.refetchOnMount)}function oe(t,e,i){if(T(e.enabled,t)!==!1){const r=typeof i=="function"?i(t):i;return r==="always"||r!==!1&&he(t,e)}return!1}function ge(t,e,i,r){return(t!==e||T(r.enabled,t)===!1)&&(!i.suspense||t.state.status!=="error")&&he(t,i)}function he(t,e){return T(e.enabled,t)!==!1&&t.isStaleByTime(J(e.staleTime,t))}function Je(t,e){return!Y(t.getCurrentResult(),e)}var Oe=x.createContext(!1),Ge=()=>x.useContext(Oe);Oe.Provider;function Xe(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}var Ye=x.createContext(Xe()),Ze=()=>x.useContext(Ye),et=(t,e)=>{(t.suspense||t.throwOnError||t.experimental_prefetchInRender)&&(e.isReset()||(t.retryOnMount=!1))},tt=t=>{x.useEffect(()=>{t.clearReset()},[t])},st=({result:t,errorResetBoundary:e,throwOnError:i,query:r,suspense:d})=>t.isError&&!e.isReset()&&!t.isFetching&&r&&(d&&t.data===void 0||Me(i,[t.error,r])),it=t=>{const e=t.staleTime;t.suspense&&(t.staleTime=typeof e=="function"?(...i)=>Math.max(e(...i),1e3):Math.max(e??1e3,1e3),typeof t.gcTime=="number"&&(t.gcTime=Math.max(t.gcTime,1e3)))},rt=(t,e)=>t.isLoading&&t.isFetching&&!e,at=(t,e)=>(t==null?void 0:t.suspense)&&e.isPending,ve=(t,e,i)=>e.fetchOptimistic(t).catch(()=>{i.clearReset()});function nt(t,e,i){var l,j,m,U,b;const r=Qe(),d=Ge(),c=Ze(),n=r.defaultQueryOptions(t);(j=(l=r.getDefaultOptions().queries)==null?void 0:l._experimental_beforeQuery)==null||j.call(l,n),n._optimisticResults=d?"isRestoring":"optimistic",it(n),et(n,c),tt(c);const S=!r.getQueryCache().get(n.queryHash),[p]=x.useState(()=>new e(r,n)),R=p.getOptimisticResult(n),O=!d&&t.subscribed!==!1;if(x.useSyncExternalStore(x.useCallback(o=>{const E=O?p.subscribe(xe.batchCalls(o)):ye;return p.updateResult(),E},[p,O]),()=>p.getCurrentResult(),()=>p.getCurrentResult()),x.useEffect(()=>{p.setOptions(n,{listeners:!1})},[n,p]),at(n,R))throw ve(n,p,c);if(st({result:R,errorResetBoundary:c,throwOnError:n.throwOnError,query:r.getQueryCache().get(n.queryHash),suspense:n.suspense}))throw R.error;if((U=(m=r.getDefaultOptions().queries)==null?void 0:m._experimental_afterQuery)==null||U.call(m,n,R),n.experimental_prefetchInRender&&!Z&&rt(R,d)){const o=S?ve(n,p,c):(b=r.getQueryCache().get(n.queryHash))==null?void 0:b.promise;o==null||o.catch(ye).finally(()=>{p.updateResult()})}return n.notifyOnChangeProps?R:p.trackResult(R)}function ot(t,e){return nt(t,We)}function It(){const{t}=Fe(),{hasAccessByCodes:e}=$e(),{data:i}=ot({queryKey:["role-menu"],queryFn:async()=>{const b=await Le();return b==null?void 0:b.result.map(o=>({...o,title:o.name,key:o.id}))},initialData:[]}),r=je({mutationFn:_e}),[d,c]=x.useState(!1),[n,S]=x.useState(""),[p,R]=x.useState({}),O=x.useRef(null),l=async(b,o)=>{var D,Q;const E=await r.mutateAsync(b);await((D=o==null?void 0:o.reload)==null?void 0:D.call(o)),(Q=window.$message)==null||Q.success(`${t("common.deleteSuccess")} id = ${E.result}`)},j=[...ze(t),{title:t("common.action"),valueType:"option",key:"option",width:120,fixed:"right",render:(b,o,E,D)=>[F.jsx(be,{type:"link",size:"small",disabled:!e(X.update),onClick:async()=>{const Q=await Ue({id:o.id});c(!0),S(t("system.role.editRole")),R({...o,menus:Q.result})},children:t("common.edit")},"editable"),F.jsx(qe,{title:t("common.confirmDelete"),onConfirm:()=>l(o.id,D),okText:t("common.confirm"),cancelText:t("common.cancel"),children:F.jsx(be,{type:"link",size:"small",disabled:!e(X.delete),children:t("common.delete")})},"delete")]}],m=()=>{c(!1),R({})},U=()=>{var b;(b=O.current)==null||b.reload()};return F.jsxs(Ae,{className:"h-full",children:[F.jsx(He,{adaptive:!0,columns:j,actionRef:O,request:async b=>{const o=await ke(b);return{...o,data:o.result.list,total:o.result.total}},headerTitle:`${t("common.menu.role")} （${t("common.demoOnly")}）`,toolBarRender:()=>[F.jsx(Ne,{icon:F.jsx(Ve,{}),type:"primary",disabled:!e(X.add),onClick:()=>{c(!0),S(t("system.role.addRole"))},children:t("common.add")},"add-role")]}),F.jsx(Pe,{title:n,open:d,onCloseChange:m,detailData:p,refreshTable:U,treeData:Be(i||[])})]})}export{It as default};
