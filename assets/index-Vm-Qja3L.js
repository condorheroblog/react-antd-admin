import{aQ as Z,aY as ee,C as re,aS as S,aV as ne,aP as v,bl as oe,r as te,aW as O,M as le,aX as g}from"./antd-BreSrAtA.js";import{o as ae}from"./index-1qU7M37A.js";import{a as i,R as I}from"./react-UQ1dNgW8.js";import{j as f}from"./index-B4D4TeV5.js";import{B as ie}from"./BaseForm-BBX0u0Gz.js";var se=["children","trigger","onVisibleChange","onOpenChange","modalProps","onFinish","submitTimeout","title","width","visible","open"];function me(s){var m,p,D=s.children,h=s.trigger,_=s.onVisibleChange,$=s.onOpenChange,e=s.modalProps,k=s.onFinish,C=s.submitTimeout,B=s.title,H=s.width,R=s.visible,M=s.open,a=Z(s,se);ee(!a.footer||!(e!=null&&e.footer),"ModalForm 是一个 ProForm 的特殊布局，如果想自定义按钮，请使用 submit.render 自定义。");var T=i.useContext(re.ConfigContext),W=i.useState([]),A=S(W,2),G=A[1],L=i.useState(!1),V=S(L,2),y=V[0],w=V[1],Q=ne(!!R,{value:M||R,onChange:$||_}),E=S(Q,2),P=E[0],d=E[1],F=i.useRef(null),U=i.useCallback(function(o){F.current===null&&o&&G([]),F.current=o},[]),b=i.useRef(),X=i.useCallback(function(){var o,r,n,l=(o=(r=a.form)!==null&&r!==void 0?r:(n=a.formRef)===null||n===void 0?void 0:n.current)!==null&&o!==void 0?o:b.current;l&&e!==null&&e!==void 0&&e.destroyOnClose&&l.resetFields()},[e==null?void 0:e.destroyOnClose,a.form,a.formRef]);i.useImperativeHandle(a.formRef,function(){return b.current},[b.current]),i.useEffect(function(){(M||R)&&($==null||$(!0),_==null||_(!0))},[R,M]);var Y=i.useMemo(function(){return h?I.cloneElement(h,v(v({key:"trigger"},h.props),{},{onClick:function(){var o=O(g().mark(function n(l){var u,t;return g().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:d(!P),(u=h.props)===null||u===void 0||(t=u.onClick)===null||t===void 0||t.call(u,l);case 2:case"end":return c.stop()}},n)}));function r(n){return o.apply(this,arguments)}return r}()})):null},[d,h,P]),q=i.useMemo(function(){var o,r,n,l,u,t,x;return a.submitter===!1?!1:oe({searchConfig:{submitText:(o=(r=e==null?void 0:e.okText)!==null&&r!==void 0?r:(n=T.locale)===null||n===void 0||(n=n.Modal)===null||n===void 0?void 0:n.okText)!==null&&o!==void 0?o:"确认",resetText:(l=(u=e==null?void 0:e.cancelText)!==null&&u!==void 0?u:(t=T.locale)===null||t===void 0||(t=t.Modal)===null||t===void 0?void 0:t.cancelText)!==null&&l!==void 0?l:"取消"},resetButtonProps:{preventDefault:!0,disabled:C?y:void 0,onClick:function(N){var j;d(!1),e==null||(j=e.onCancel)===null||j===void 0||j.call(e,N)}}},(x=a.submitter)!==null&&x!==void 0?x:{})},[(m=T.locale)===null||m===void 0||(m=m.Modal)===null||m===void 0?void 0:m.cancelText,(p=T.locale)===null||p===void 0||(p=p.Modal)===null||p===void 0?void 0:p.okText,e,a.submitter,d,y,C]),z=i.useCallback(function(o,r){return f.jsxs(f.Fragment,{children:[o,F.current&&r?f.jsx(I.Fragment,{children:te.createPortal(r,F.current)},"submitter"):r]})},[]),J=i.useCallback(function(){var o=O(g().mark(function r(n){var l,u,t;return g().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return l=k==null?void 0:k(n),C&&l instanceof Promise&&(w(!0),u=setTimeout(function(){return w(!1)},C),l.finally(function(){clearTimeout(u),w(!1)})),c.next=4,l;case 4:return t=c.sent,t&&d(!1),c.abrupt("return",t);case 7:case"end":return c.stop()}},r)}));return function(r){return o.apply(this,arguments)}}(),[k,d,C]),K=ae(P);return f.jsxs(f.Fragment,{children:[f.jsx(le,v(v(v({title:B,width:H||800},e),K),{},{onCancel:function(r){var n;C&&y||(d(!1),e==null||(n=e.onCancel)===null||n===void 0||n.call(e,r))},afterClose:function(){var r;X(),P&&d(!1),e==null||(r=e.afterClose)===null||r===void 0||r.call(e)},footer:a.submitter!==!1?f.jsx("div",{ref:U,style:{display:"flex",justifyContent:"flex-end"}}):null,children:f.jsx(ie,v(v({formComponentType:"ModalForm",layout:"vertical"},a),{},{onInit:function(r,n){var l;a.formRef&&(a.formRef.current=n),a==null||(l=a.onInit)===null||l===void 0||l.call(a,r,n),b.current=n},formRef:b,submitter:q,onFinish:function(){var o=O(g().mark(function r(n){var l;return g().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,J(n);case 2:return l=t.sent,t.abrupt("return",l);case 4:case"end":return t.stop()}},r)}));return function(r){return o.apply(this,arguments)}}(),contentRender:z,children:D}))})),Y]})}export{me as M};
